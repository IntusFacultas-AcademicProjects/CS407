{% extends 'base.html' %}
{% load widget_tweaks %}

{% block title %}AuditionMe!{% endblock %}

{% block content %}
<div id="jsonData" js-data="{{some_django_variable}}"></div>
<div id="filterDiv">
<div class = "row">
    <div class = "col-sm-6">
        <div class = "panel panel-default">
            <div class="panel-heading">Filter by Text</div>
            <div class="panel-body">
                <form id="text-filter">
                    <div class="input-group">
                        <input type="text" class="form-control" v-model="filterText" placeholder="Enter text to filter by">
                        <div class="input-group-btn">
                            <button v-on:click="getFilterText(filterText)" class="btn btn-primary" type="button">
                                <i class="glyphicon glyphicon-search"></i>
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <div class ="col-sm-6">
        <div class = "panel panel-default">
            <div class="panel-heading">Filter by Tag</div>
            <div class="panel-body">
                <span class="badge badge-primary" v-for="tag in tags" v-on:click="getFilterTag(tag)">(( tag ))</span>
            </div>
        </div>
    </div>
</div>
<div class = "row">
    <div class = "col-sm-6">
        <div class = "panel panel-default">
            <div class="panel-heading">Filter by Date</div>
            <div class="panel-body">
                <div class="form-group">
                    <div class='input-group date' id='datetimepicker1'>
                        <input type='text' class="form-control" v-model="filterDate" />
                        <span class="input-group-addon">
                            <span class="glyphicon glyphicon-calendar"></span>
                        </span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class ="col-sm-6">
        <div class = "panel panel-default">
            <div class="panel-heading">Filter by Location</div>
            <div class="panel-body">Yeah IDK bout this one</div>
        </div>
    </div>
</div>
<div class="row">
    <div class="col-sm-12">
        <div class='wrapper' style="height: 70%">
            <table id="roles" class="table table-hover table-striped">
                <thead>
                    <tr style="background-color:white;">
                        <th>Role</th>
                        <th>Tags</th>
                        <th>&nbsp;</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Example</td>
                        <td><span class="badge badge-primary">TAGS</span>
                        <span class="badge badge-primary">N'</span>
                        <span class="badge badge-primary">SHIT</span>
                        </td>
                        <td><button class="btn btn-primary btn-sm">View</button></td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>
</div>
{% endblock %}

{% block js %}
<script type="text/javascript">
    $(function() {
        var unparsed = $("#jsonData").attr("js-data")
        parsed = processJS(unparsed)    
         $("#results").floatThead({
            scrollContainer: function($table){
                return $table.closest('.wrapper');
            }
        });
    }),

    $(function() {
        filterApp = new Vue({
            el: "#filterDiv",
            delimiters: ["((","))"],
            // This is data that needs to be 2 way bound (such as the filter input)
            // These cannot be set to undefined/null. 
            data: {
                filterText: "",
                filterTags: [],
                filterDate: "",
                tags: ["Male", "Female", "Blonde", "Brunette", "Redhead", "TAGS", "N'", "SHIT"],
            },
            mounted: function() {
                $('#datetimepicker1').datetimepicker();
                // we save the 'this' keyword here because once we enter the next scope
                // 'this' will become the jQuery object $("#datetimepicker1") so
                // in order to access the app, we save it to a local variable
                var internalApp = this;
    
                // Eonasdan does not support Vue out of the box, so we use jQuery event handler
                // catching the custom event from Eonasdan's API. 
                $('#datetimepicker1').on('dp.change', function() {
                    // get the date object in MomentJS Date Object format
                    var momentJSDateObj = $('#datetimepicker1').data('DateTimePicker').date();
                    // example of how to convert it to string
                    console.log(momentJSDateObj.format('YYYY-MM-DD'));
                    // saving it to Vue
                    internalApp.filterDate = momentJSDateObj;
                    console.log("Vue data object follows:");
                    console.log(internalApp.filterDate)
                });
            },
            methods: {
                getFilterText: function(filterText) {
                    if (event) {
                        filterApp.filterText = filterText;
                        console.log(filterApp.filterText);
                    }
                },

                getFilterTag: function(filterTag) {
                    if (event) {
                        var found = 0;
                        for (i = 0; i < filterApp.filterTags.length; i++) {
                            if (filterApp.filterTags[i] == filterTag) {
                                if (i != filterApp.filterTags.length - 1) {
                                    var temp = filterApp.filterTags[filterApp.filterTags.length - 1];
                                    filterApp.filterTags[filterApp.filterTags.length - 1] = filterApp.filterTags[i];
                                    filterApp.filterTags[i] = temp;
                                    filterApp.filterTags.pop();
                                    found = 1;
                                    break;
                                }
                                else {
                                    filterApp.filterTags.pop();
                                    found = 1;
                                }
                            }
                        }
                        if (found == 0) {
                            filterApp.filterTags.push(filterTag);
                        }
                        console.log(filterApp.filterTags);
                    }
                },
            },
        })
    })
</script>
{% endblock js %}
